\chapter{Financial Market Economies}


\section{Arrow-Debreu Equilibrium}
\begin{definition}
  An Arrow-Debreu equilibrium is defined by an allocation $x_0, \{x_s\}$,
  such that 
  \begin{enumerate}
    \item given the goods prices $\phi_0, \phi_s$, the allocation solves the 
    consumer's problem below:
    \begin{align*}
      \max_{x_o, \{x_s\}} \quad & u_0(x_0) + \sum_{s} \text{Prob}_s u_s(x_s) \\
      \text{s.t.} \quad & \phi_0 (x_0 - w_0^i) + \sum_s \phi_s (x_s - w_s^i) = 0
    \end{align*}
    \item Goods market clears:
    \[
    \sum_i x^i \leq \sum_i w^i
    \]
\end{enumerate}
\end{definition}









\section{No-Arbitrage}

There are multiple definitions of the No Arbitrage condition.
Essentially, they all require zero profit on the spot market at time 0, 
and the future financial market no matter what the future state will be.
Formally, the first definition is given by

\begin{tcolorbox}
\textbf{Definition I (No Arbitrage):}
Let $A \in \mathbb{R}^{S \times J}$ be a future return matrix.
Let $z \in \mathbb{R}^{J}$ be a portfolio.
$q^{T} \in \mathbb{R}^{J}$ be a price vector of the portfolio.%
\footnote{
    In this note, only $q$ is a row vector, while other vectors are columns. 
}
For $W = \begin{bmatrix}
  -q \\ A
\end{bmatrix}$,
there is no $z \in \mathbb{R}^{J}$ such that $Wz > 0$.
\\
\begin{itemize}
  \item \textbf{Remark:} Intuitively, $Wz \in \mathbb{R}^{S+1}$ denotes the profit of buying/selling assets on the spot market and all the future financial markets. 
\end{itemize}
\end{tcolorbox}
\noindent \textit{Example:} Consider 
$W = \begin{bmatrix}
-3 & -4  \\ 5 & 0 \\ 2 & 2 \\ 3 & 1
\end{bmatrix}.$
Then take $z = \begin{bmatrix}
1 \\ -1 
\end{bmatrix}$ (namely, buying 1 unit of asset 1 and selling 1 unit of asset 2),
we have 
$Wz = \begin{bmatrix}
1  \\ 5 \\ 0 \\ 2
\end{bmatrix},$
which means the agent can make profit 1 at time 0 (on the spot market), and 
5, 0, 2 at time 1 if $s = 1, 2, 3$, respectively.


The No Arbitrage condition above is (mathematically) equivalent to the following definition
\begin{tcolorbox}
\textbf{Definition II (No Arbitrage):}
\[
\text{span}(W) \cap \mathbb{R}^{S+1}_{+} = \{ \bm{0}\},
\]
where $\text{span}(W) = \{Wz, \forall z \in \mathbb{R}^{J} \}$ denotes the profit of all posible portfolio.
\end{tcolorbox}


With these two definitions in mind, we now introduce the No-Arbitrage theorem
\begin{tcolorbox}
\textbf{Defintion (No-Arbitrage Theorem)}
\[
\text{span}(W) \cap \mathbb{R}^{S+1}_{+} = \{ \bm{0}\} \Leftrightarrow
\exists \hat{\pi} \in \mathbb{R}^{S+1}_{++} \text{ such that } \hat{\pi}  \tau = 0, \forall \tau \in \text{span}(W)
\]
\textbf{Remarks}: 
\begin{itemize}
  \item We require $\hat{\pi} \in \mathbb{R}^{S+1}_{++}$ (strictly positive) due to the need of normalization (see below).
\end{itemize}
\end{tcolorbox}

Intuitively, $\hat{\pi}$ serves as a machinery that summarizes the agent's profit at time 0 and time 1, 
taking probabilities and discount factors into considerations:
\[
\hat{\pi}_0 [Wz]_{0} + \sum_s \hat{\pi}_s  [Wz]_{s} = 0, \quad \forall z \in \mathbb{R}^{J}
\]
Since $[Wz]_{0} = - \sum_j q_j z_j $, after the normalization $\pi_s = \frac{\hat{\pi}_s}{\hat{\pi}_0}$, we have 
\[
- \sum_j q_j z_j  +  \sum_s \pi_s \sum_j a_{sj} z_j = 0,
\]
where $\pi_s$ denotes the price of one unit of consumption good delivered in state $s$ at time 1.
In matrix form, we have $(-q + \pi^{T} A) z = 0 \Rightarrow q = \pi^{T} A$.
\begin{tcolorbox}
Defining $\pi_s = m_s \text{Prob}_s$, we have the \textbf{Fundamental Equation of Asset Pricing}:
\begin{equation}
    \label{eqn:fundamental_asset_pricing_eqn}
    q = \mathbb{E}\left(m A \right).
\end{equation}
\end{tcolorbox}

\clearpage
\begin{tcolorbox}
\textbf{Defintion (No-Arbitrage Theorem)}
\[
\text{span}(W) \cap \mathbb{R}^{S+1}_{+} = \{ \bm{0}\} \Leftrightarrow
\exists \hat{\pi} \in \mathbb{R}^{S+1}_{++} \text{ such that } \hat{\pi}  \tau = 0, \forall \tau \in \text{span}(W)
\]
\end{tcolorbox}
\noindent \textbf{Proof of the No-Arbitrage Theorem}
\begin{itemize}
  \item[($\Rightarrow$)]
  We prove this direction in two steps:
  \begin{enumerate}
    \item \textcolor{blue}{``Strict positivity''}.
    First, we define a simplex in the space of $\mathbb{R}^{S+1}$: 
    \[
    \Delta = \{\tau \in \mathbb{R}^{S+1}: \sum_{s=0}^S \tau_s = 1 \}
    \] 
    By the definition of No-Arbitrage condition (i.e., the LHS of the theorem), 
    we have
    \[
    \text{span}(W) \cap \Delta = \emptyset
    \]
    Now, invoking the \textbf{Strong Separating Hyperplane Theorem} (this is the essence of the proof),
    then there exists $\hat{\pi}$, such that
    \begin{equation}
      \label{eqn:no_arbitrage_proof_key}
      \sup_{\tau \in \text{span}(W)} \hat{\pi} \tau < 
      \inf_{\tau \in \Delta} \hat{\pi} \tau
    \end{equation}
    To prove $\hat{\pi} \in \mathbb{R}^{S+1}_{++}$, 
    suppose there exists a $\hat{\pi}$ whose $s^{th}$ component, $\pi_s \leq 0$, 
    then since the base vector ($e_s \in \Delta $), we have 
    $$\inf_{\tau \in \Delta} \hat{\pi} \tau \leq e_s \tau \leq 0 $$
    However, $0 \in \text{span}(W)$ (in words, no buying and selling in the asset market), 
    which implies that 
    \[
    \sup_{\tau \in \text{span}(W)} \hat{\pi} \tau \geq \hat{\pi} 0  = 0
    \]
    Hence, we have the $ 0 \leq LHS < RHS \leq 0$ in equation~(\ref{eqn:no_arbitrage_proof_key}), 
    a contradiction. 
  \item \textcolor{blue}{``Orthorgonality''}.. Suppose there exists a $\tau \in \text{span}(W)$ such that $\hat{\pi} \tau \neq 0$.
  Then, we can find an $\alpha$ such that $\hat{\pi} \alpha \tau$ is arbitrarily large.
  (In words, agent can make infinite profit if there is an opporitunity for arbitrage).
  However, the RHS of the theorem is bounded above (because $\Delta$ is a compact set).
  Then we have a contradiction. Hence, 
  \[
  \hat{\pi} \tau = 0 \forall \tau \in \text{span}(W)
  \]
  \end{enumerate}
  \item[($\Leftarrow$)] Now suppose there exists an arbitrage opportunity $\tau^* \in \text{span}(W)$ such that 
  $\tau^* \in \mathbb{R}^{S+1} \backslash \{0 \}$.
  Since $\hat{\pi} \in  \mathbb{R}^{S+1}_{++}$, we have $\hat{\pi} \tau^* > 0$.
  However, this contradicts to the assumption that 
  $\hat{\pi} \text{span}(W) = 0$ as $\tau^* \in \text{span}(W)$. \(\blacksquare\)
\end{itemize}











\begin{tcolorbox}
\textbf{Proposition. (The degree of freedom of stochastic discounts)}
Given $A \in \mathbb{R}^{S\times J}$ of rank $J$ and $q \in \mathbb{R}^J$, the set of viable stochastic discounts 
is an $\mathbb{R}^{S-J}$ strictly positive subspace of $\mathbb{R}^J$, namely,
\[
R(q;A)  = \{\pi \in \mathbb{R}^S_{++}: q = \pi^T A \} = \mathbb{R}^{S-J}_{++}
\]
In words, once you find a viable $\pi$, there are only $S-J$ elements in that $\pi$ you can vary.
\end{tcolorbox}



\section{Arrow Theorem}
\subsection{Budget constraints equivalence}
\begin{proposition}
  \label{prop:equiv_constraints_FME}
  The following two budget constraints are equivalent under No-Arbitrage:
  \begin{enumerate}
    \item $p_0 (x_0^i - w_0^i) + q z = 0 \quad \text{ and } \quad  p_s (x_s^i - w_s^i) = a_s z$
    \item $p_0 (x_0^i - w_0^i) + \sum_s \pi_s p_s (x_s^i - w_s^i) = 0 \quad$ and, 
    \[
    \begin{bmatrix} 
      \vdots \\
      p_s (x_s^i - w_s^i) \\
      \vdots \\
    \end{bmatrix} \in \text{span}(A)
    \]
  \end{enumerate}
\end{proposition}
\noindent \textit{Remarks:} When the asset market is complete $\text{span}(A) = \mathbb{R}^{J} = \mathbb{R}^{S}$.

\noindent \textbf{Proof}
Suppose $q$ satisfies the No-Arbitrage condition, we have the following asset pricing equation
\[
q = \pi A, \quad \text{ with } q \in  \mathbb{R}^{J}, \pi \in  \mathbb{R}^{S}, A \in \mathbb{R}^{S \times J}
\]
Now the first equation of the first set of constraints becomes
\[
p_0 (x_0^i - w_0^i) + q z = p_0 (x_0^i - w_0^i) + \pi A z = 0,
\]
which is equivalent to 
\[
p_0 (x_0^i - w_0^i) + \sum_s \pi_s a_s z  = 0
\]
Using the the second equation of the first set of constraints to replace $a_s z$, we have 
\[
p_0 (x_0^i - w_0^i) + \sum_s \pi_s p_s(x_s^i - w_s^i)  = 0
\]
To complete the proof, notice that the second equation of the second set of constraints is simply the matrix for of 
\[
p_s (x_s^i - w_s^i) = a_s z
\]
\noindent $\Rightarrow$
\[
    \begin{bmatrix} 
      \vdots \\
      p_s (x_s^i - w_s^i) \\
      \vdots \\
    \end{bmatrix} = 
        \begin{bmatrix} 
      \vdots \\
      a_s \\
      \vdots \\
    \end{bmatrix} z
\]
which belongs to the span of $A$. \(\blacksquare\)

\begin{tcolorbox}
  When $L = 1$, we can use the above statement about ``constraint equivalence'' to show that 
  \\
  \underline{the constrained set of consumption $B^i \perp p$}, and thus we have constrained P.E. 
  Namely, 
  \[
  \left(B^i := \begin{cases}
    x^i_0 - w^i_0 + \sum_{s=1}^{S} \pi_s (x^i_s - w^i_s) = 0 \\
    [(x^i_s - w^i_s)]_{\forall s} \in \langle A \rangle
  \end{cases}
  \right)
  \perp q
  \]
  Notice that we use $q = \pi A$ in the derivation of the first equation of $B^i$.
  However, in the presence of transaction costs, $q \leq \pi A \leq q + \gamma$, 
  the tricks we used in the proof of Proposition~\ref{prop:equiv_constraints_FME} break down. 
  Hence, $B^i(q)$ is a function of $q$ when $\gamma > 0$.
\end{tcolorbox}


\subsection{Arrow's Theorem}
\begin{theorem}[Arrow's Theorem]
  Under the No-Arbitrage condition, 
  any Arrow-Debreu equilibrium $(x_0^*, \{x_s^*\}, \{p_0^*, p_s^* \})$ 
  can be supported as a Financial Market Equilibrium (FME) $(x_0^*, \{x_s^*\}, z^*, \{p_0^*, q^* \})$,
  where $z^*$ is the portfolio that satisfies the budget constraints in the FME, 
  and $q^*$ satisfies the No-Arbitrage condition.
\end{theorem}

\noindent \textbf{Proof}
Since goods market clearing implies financial market clearing, the market clearing conditions in 
the FME is the same as the one in Arrow-Debreu equilibrium.
Now, we only need to discuss the equivalence of the budget constraints between these two economies.

Since the market in complete, the span condition in the FME is not binding.
Then the budget constraints in the FME reduce to
\[
p_0 (x_0^i - w_0^i) + \sum_s \pi_s p_s (x_s^i - w_s^i) = 0
\]
Now using $p_0 = \phi_0$ and $p_s = \pi_s \phi_s$,
we can immediately see the equivalence between the AD equilibrium and the FME. \(\blacksquare\)



\section{Non-convexity}
\begin{tcolorbox}
  \begin{proposition}
    In economies with non-convex commodity space, 
    an equilibrium may fail to exist.
  \end{proposition}
\end{tcolorbox}
\noindent \textbf{Proof (Sketch):}
Consider an economy with non-covex commodity space, 
for example, when the quantities of some goods are discrete (namely, indivisible goods).
Then, the aggregate excess demand function may not be continuous.
To tackle this issue, one can consider the convex hull of the aggregate excess demand function.
By Kakutani's FPT, we have $0 \in \text{conv}(Z(\pi, p))$.
If $0 \in Z(\pi, p)$, then we are done.
Otherwise, we can apply the Caratheodory's theorem to find $S+1 +1$ vector such that 
$\sum \alpha_k z_k = 0 \text{ with } z_k \in Z(\pi, p), \alpha_k \geq 0, \sum \alpha_k = 1$.
Since agent $i$ is indifferent among $\{z_{ik}\}$ across $k$,
we can assign $\alpha_k$ fraction of type $i$ agents to choose $z_{ik}$.
As a result, the aggregate excess demand is zero. \(\blacksquare\)


\section{Cass Trick}
\textbf{Question:}  What is the Cass trick and how is it useful in the existence proof for 
(single commodity, two-periods) financial market economies with incomplete markets?

\textbf{Answer:} 
The definition of the Cass trick. 
Consider an economy where the span condition is imposed on all consumers except $i=1$.
Then, the Cass trick aruges that the Financial market equilibrium (FME) is the same as the 
``modified'' FME.
% The intuition behind this equivalence is that 
% if one individual can access to the complete market and anyone else can trade with that 
% individual, then the whole economy is complete.
We use the conclusion of the Cass trick to establish the boundary condition of the FME.
Specifically, for $i=1$, her excess demand goes to infinity as price goes to zero.
Using the budget constraints for other individuals, we can see that the 
the excess demand is bounded from below. 
Hence, using the same proof as in the existence proof of the AD-equilibrium, 
we can establish the existence. 




\section{Aggregation}
As many economic analysis are conducted under the representative agent framework,
such as the canonical consumption-based CAPM model, 
it is important to understand under what conditions we can aggregate agents' behavior.

\begin{tcolorbox}
  \begin{proposition}
    \label{prop:budget_sep_thm}
    If utility functions are identitical and homethetic, we have the equilibrium prices \textbf{independent} 
    of the distribution of endowments across agents.
    (In other words, $p$ is a functionm of only aggregate endowmenet $\sum_i w^i$.)
  \end{proposition}
\end{tcolorbox}

\noindent \textbf{Proof of proposition~\ref{prop:budget_sep_thm} (Sketch):}
Define demand function $x_s^i(p_s, y_s^i)$.
By Walras' law, we have $p_s x_s^i(p_s, y_s^i) = y_s^i$, and $\sum_i y_s^i = p_s \sum_i x^i_s = p_s \sum_i w^i_s$.
Then, we have 
\begin{align*}
  & \sum_i p_s x_s^i(p_s, y_s^i) = \sum_i y_s^i \\ 
  \Rightarrow \quad & \sum_i p_s x_s(p_s, y_s^i)  = p_s \sum_i w^i_s \\
  \Rightarrow \quad & p_s \sum_i  y_s^i x_s(p_s, 1) = p_s \sum_i w^i_s \\
  \Rightarrow \quad & \sum_i y_s^i x_s(p_s, 1) =  \sum_i w^i_s \\
  \Rightarrow \quad &  x_s(p_s, \sum_i y_s^i) =  \sum_i w^i_s \\
  \Rightarrow \quad  &  x_s(p_s, p_s \sum_i w^i_s) =  \sum_i w^i_s
\end{align*}
Therefore, $p_s$ is uniquely determined by the equation above. \(\blacksquare\)

